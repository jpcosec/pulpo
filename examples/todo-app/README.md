# Todo List Application Example

Simple todo list application demonstrating Pulpo Core's workflow management and automatic CRUD generation.

## Overview

This example shows how to build a task management application with:
- Simple data models (User, Todo)
- Automatic CRUD endpoints (via Beanie + FastAPI)
- Workflow operations (status transitions)
- Hierarchical operation naming

## Project Structure

```
todo-app/
├── main                # Project entrypoint (imports models + operations)
├── models/
│   ├── user.py         # User account model
│   └── todo.py         # Todo item model with status
└── operations/
    └── workflow.py     # Status transitions and archival
```

**Note:** CRUD operations are automatically generated by Pulpo/Beanie/FastAPI from the models. No explicit CRUD operations needed!

## Models

### User
```python
@datamodel(name="User", tags=["user", "account"])
class User(Document):
    username: str          # Unique username
    email: str            # Email address
    created_at: datetime  # Account creation time
    updated_at: datetime  # Last update time
```

### Todo
```python
@datamodel(name="Todo", tags=["task", "todo"])
class Todo(Document):
    title: str                    # Task title
    description: str              # Detailed description
    status: TodoStatus            # pending | in_progress | completed
    created_by: str              # Creator username
    created_at: datetime         # Creation timestamp
    updated_at: datetime         # Last update timestamp
```

## Operations

### Workflow Operations (todos.workflow.*)

Status transition operations that change todo state. These are custom operations (CRUD is automatic).

```bash
# Start working on a todo
./main ops start --input '{"todo_id": "507f1f77bcf86cd799439011"}'

# Mark todo as completed
./main ops complete --input '{"todo_id": "507f1f77bcf86cd799439011"}'

# Reopen a completed todo
./main ops reopen --input '{"todo_id": "507f1f77bcf86cd799439011"}'

# Archive old completed todos
./main ops archive --input '{"days_old": 7}'
```

## Operation Hierarchy Graph (OHG)

```
todos (domain)
└── workflow (category)
    ├── start     # Changes status to in_progress
    ├── complete  # Marks done (status: completed)
    ├── reopen    # Reopens completed (status: pending)
    └── archive   # Cleans up old todos
```

**Note:** CRUD endpoints (list, create, read, update, delete) are automatically generated from the Todo model - no explicit operations needed!

## Generated Artifacts

Running `pulpo compile` generates:

```
.run_cache/
├── generated_api.py              # FastAPI routes for CRUD + operations
├── generated_ui_config.ts        # React/UI configuration
└── orchestration/
    └── generated_flows.py        # Prefect workflows
```

### Generated API Endpoints

```
# Automatic CRUD endpoints (from @datamodel)
GET    /todos                      # List all todos
POST   /todos                      # Create new todo
GET    /todos/{id}                # Get todo by ID
PUT    /todos/{id}                # Update todo
DELETE /todos/{id}                # Delete todo

# Custom workflow operation endpoints
POST   /operations/todos/workflow/start
POST   /operations/todos/workflow/complete
POST   /operations/todos/workflow/reopen
POST   /operations/todos/workflow/archive
```

## Running the Example

### 1. Extract the project
```bash
tar -xzf todo-app.tar.gz
cd todo-app
```

### 2. Install Pulpo Core
```bash
pip install pulpo-core
```

### 3. Initialize services
```bash
./main init
```

Sets up:
- MongoDB connection
- Environment variables
- Database initialization

### 4. Generate code
```bash
./main compile
```

Generates:
- API routes (FastAPI)
- CLI commands (Typer)
- React UI configuration
- Prefect workflows

### 5. Start services
```bash
./main up
```

Starts:
- MongoDB (database)
- FastAPI server (port 8000)
- React frontend (port 3000)
- Prefect orchestrator

### 6. Use the application

#### Via API (CRUD - Automatic)
```bash
# Create a todo
curl -X POST http://localhost:8000/todos \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Learn Pulpo",
    "description": "Understand the framework",
    "created_by": "user123"
  }'

# List todos
curl http://localhost:8000/todos

# Get specific todo
curl http://localhost:8000/todos/{id}

# Update todo
curl -X PUT http://localhost:8000/todos/{id} \
  -H "Content-Type: application/json" \
  -d '{"title": "Updated Title"}'

# Delete todo
curl -X DELETE http://localhost:8000/todos/{id}
```

#### Via API (Workflow Operations)
```bash
# Start working on a todo
curl -X POST http://localhost:8000/operations/todos/workflow/start \
  -H "Content-Type: application/json" \
  -d '{"todo_id": "..."}'

# Mark as complete
curl -X POST http://localhost:8000/operations/todos/workflow/complete \
  -H "Content-Type: application/json" \
  -d '{"todo_id": "..."}'
```

#### Via CLI
```bash
# View project status
./main status

# List operations
./main ops_list

# View relationship diagram
./main graph
```

#### Via UI
Open http://localhost:3000 in browser

### 7. Stop services
```bash
./main down
```

## Key Concepts Demonstrated

### 1. Hierarchical Operation Naming
```
Domain: todos
Category: crud, workflow, sync
Operation: create, read, update, delete, start, complete, reopen, archive

Name format: {domain}.{category}.{operation}
Example: todos.crud.create
```

### 2. Async Operations
All operations are async:
```python
@operation(name="todos.crud.create", ...)
async def create_todo(input_data: CreateTodoInput) -> CreateTodoOutput:
    ...
```

### 3. Input/Output Models
Pydantic models for type validation:
```python
class CreateTodoInput(BaseModel):
    title: str
    description: str
    created_by: str

class CreateTodoOutput(BaseModel):
    success: bool
    todo_id: str
    message: str
```

### 4. Model Registration
Models and operations registered via decorators:
- `@datamodel` - Register data models
- `@operation` - Register operations

### 5. Metadata-Driven Generation
All code (API, CLI, UI, workflows) generated from decorator metadata.

## Use Cases

### Personal Task Management
Use for managing personal todo lists:
- Create tasks
- Track progress (pending → in_progress → completed)
- Archive old tasks

### Team Task Board
Extend with team collaboration:
- Assign todos to users
- Add due dates
- Add comments/notes

### Project Management
Integrate with larger system:
- Hierarchy of projects and tasks
- Time tracking
- Resource allocation

## Testing

All operations are covered by Phase 3 tests:
```bash
python -m pytest tests/phase3/test_real_example.py -v
```

Tests verify:
- Operations are discoverable
- Generated code is valid
- Flows execute correctly
- Status transitions work

## Next Steps

1. Customize for your use case
2. Add additional fields to models
3. Add more sophisticated workflows
4. Integrate with external systems
5. Add user authentication

---

**Pulpo Core v0.6.0** - Framework for building full-stack applications
